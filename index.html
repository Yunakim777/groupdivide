<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор Групп и Ролей</title>
    <!-- Подключение Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Установка шрифта Inter и базового стиля */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Стили для скроллбара, чтобы он был менее навязчивым */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto">
        <header class="mb-8">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2">Делитель на Группы и Распределитель Ролей</h1>
            <p class="text-gray-600">Введите список учеников (одно имя на строку) и нажмите "Сформировать группы".</p>
        </header>

        <main class="bg-white p-6 rounded-xl shadow-2xl">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

                <!-- Блок ввода данных -->
                <div class="lg:col-span-1">
                    <label for="student-names" class="block text-sm font-medium text-gray-700 mb-2">Список учеников</label>
                    <textarea id="student-names" rows="15" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="Иван Петров
Мария Сидорова
Алексей Кузнецов
..."></textarea>

                    <button id="generate-button" class="mt-4 w-full px-4 py-3 bg-blue-600 text-white font-semibold rounded-xl shadow-md hover:bg-blue-700 transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 disabled:bg-gray-400">
                        Сформировать группы
                    </button>
                    <div id="error-message" class="mt-3 text-sm text-red-600 font-medium hidden"></div>
                </div>

                <!-- Блок вывода результатов -->
                <div class="lg:col-span-2">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Результаты распределения:</h2>
                    <!-- Удалены фиксированная высота (h-96) и прокрутка (overflow-y-auto) -->
                    <div id="output-container" class="bg-gray-50 p-4 border border-gray-200 rounded-lg min-h-[10rem]">
                        <p class="text-gray-500 text-center py-10">Результаты групп появятся здесь после генерации.</p>
                    </div>

                    <div id="copy-container" class="mt-4 hidden">
                        <button id="copy-button" class="w-full px-4 py-3 bg-green-600 text-white font-semibold rounded-xl shadow-md hover:bg-green-700 transition duration-150 ease-in-out transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50">
                            Копировать результаты
                        </button>
                        <p class="text-xs text-gray-500 mt-2 text-center">Копирует отформатированный текст для вставки в документ.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const namesInput = document.getElementById('student-names');
            const generateButton = document.getElementById('generate-button');
            const outputContainer = document.getElementById('output-container');
            const errorMessage = document.getElementById('error-message');
            const copyButton = document.getElementById('copy-button');
            const copyContainer = document.getElementById('copy-container');
            const groupSize = 6;
            
            // Фиксированный список ролей, который нужно распределить
            const ROLES = [
                'Главный Редактор',
                'Археолог-Консультант',
                'Иллюстратор/Дизайнер',
                'Медиа-Продюсер',
                'Медиа-Продюсер',
                'Медиа-Продюсер'
            ];

            // --- Вспомогательные функции ---

            /**
             * Случайное перемешивание массива (алгоритм Фишера-Йетса).
             * @param {Array} array - Массив для перемешивания.
             */
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            /**
             * Проверяет, что все имена уникальны и не пусты.
             * @param {string[]} names - Массив имен.
             * @returns {string[]} - Массив уникальных и непустых имен.
             */
            function sanitizeAndValidateNames(names) {
                const uniqueNames = new Set();
                const cleanNames = names
                    .map(name => name.trim())
                    .filter(name => name.length > 0 && !uniqueNames.has(name) && uniqueNames.add(name));
                return cleanNames;
            }

            // --- Основная логика генерации ---

            /**
             * Генерирует группы и распределяет роли.
             */
            function generateGroups() {
                errorMessage.classList.add('hidden');
                outputContainer.innerHTML = '';
                copyContainer.classList.add('hidden');

                // 1. Получение и очистка имен
                const inputNames = namesInput.value.split('\n');
                const cleanNames = sanitizeAndValidateNames(inputNames);

                if (cleanNames.length === 0) {
                    errorMessage.textContent = 'Пожалуйста, введите список учеников.';
                    errorMessage.classList.remove('hidden');
                    return;
                }

                // 2. Случайное перемешивание всего списка учеников
                const shuffledNames = shuffleArray(cleanNames);
                const totalStudents = shuffledNames.length;
                let groups = [];
                let studentIndex = 0;
                let groupCounter = 1;

                while (studentIndex < totalStudents) {
                    // Извлекаем следующую группу студентов
                    const currentGroupStudents = shuffledNames.slice(studentIndex, studentIndex + groupSize);
                    const currentGroupSize = currentGroupStudents.length;

                    // 3. Распределение ролей
                    // Берем копию ролей, чтобы перемешать их для каждой группы
                    let availableRoles = [...ROLES];

                    // Для группы, не кратной 6, убираем наименее критичные роли (Медиа-Продюсеры)
                    if (currentGroupSize < groupSize) {
                        const rolesToRemoveCount = groupSize - currentGroupSize;
                        // Удаляем последних N Медиа-Продюсеров из конца списка ролей
                        availableRoles = availableRoles.slice(0, currentGroupSize);
                    }
                    
                    // Перемешиваем доступные роли для случайного назначения внутри группы
                    const shuffledRoles = shuffleArray(availableRoles);

                    let group = {
                        id: groupCounter,
                        members: []
                    };

                    // Назначаем роли ученикам
                    for (let i = 0; i < currentGroupSize; i++) {
                        group.members.push({
                            name: currentGroupStudents[i],
                            role: shuffledRoles[i]
                        });
                    }

                    groups.push(group);
                    studentIndex += groupSize;
                    groupCounter++;
                }

                // 4. Отображение результатов
                renderGroups(groups, totalStudents);
            }

            /**
             * Отображает сгенерированные группы в контейнере.
             * @param {Array} groups - Массив объектов групп.
             * @param {number} totalStudents - Общее количество учеников.
             */
            function renderGroups(groups, totalStudents) {
                let htmlOutput = '';
                let textOutput = `ГЕНЕРАЦИЯ ГРУПП (${totalStudents} чел.)\n\n`;

                groups.forEach(group => {
                    const isRemainder = group.members.length < groupSize;
                    const groupTitleClass = isRemainder ? 'bg-yellow-100 text-yellow-800 border-yellow-300' : 'bg-blue-100 text-blue-800 border-blue-300';

                    // HTML-представление
                    htmlOutput += `
                        <div class="mb-6 p-4 border-2 rounded-xl shadow-lg transition duration-300 ease-in-out hover:shadow-xl">
                            <h3 class="text-lg font-bold p-2 mb-3 rounded-md ${groupTitleClass}">
                                Группа ${group.id} (${group.members.length} чел.)
                            </h3>
                            <ul class="space-y-2">
                    `;
                    textOutput += `--- ГРУППА ${group.id} (${group.members.length} чел.) ---\n`;

                    group.members.forEach(member => {
                        const roleColor = getRoleColor(member.role);
                        htmlOutput += `
                            <li class="flex items-center space-x-3 p-2 bg-white rounded-lg border-l-4 ${roleColor}">
                                <span class="font-medium text-gray-900">${member.name}</span>
                                <span class="text-sm font-semibold px-2 py-0.5 rounded-full ${roleColor.replace('border-l-4', '').replace('500', '100').replace('600', '700')} text-gray-800">${member.role}</span>
                            </li>
                        `;
                        textOutput += `  - ${member.role}: ${member.name}\n`;
                    });

                    htmlOutput += `
                            </ul>
                        </div>
                    `;
                    textOutput += '\n';
                });

                // Сообщение о неполной группе
                const remainder = totalStudents % groupSize;
                if (remainder !== 0) {
                    const message = `Примечание: Последняя группа (Группа ${groups.length}) состоит из ${remainder} человек и не является полной. Роли назначены пропорционально.`;
                    htmlOutput = `<div class="p-3 mb-4 text-sm text-yellow-800 bg-yellow-100 rounded-lg font-medium">${message}</div>` + htmlOutput;
                    textOutput = `\n${message}\n\n` + textOutput;
                } else {
                    htmlOutput = `<div class="p-3 mb-4 text-sm text-green-800 bg-green-100 rounded-lg font-medium">Все ${totalStudents} учеников распределены на полные группы по ${groupSize} человек.</div>` + htmlOutput;
                }


                outputContainer.innerHTML = htmlOutput;
                outputContainer.setAttribute('data-text-output', textOutput); // Сохраняем текст для копирования
                copyContainer.classList.remove('hidden'); // Показываем кнопку копирования
            }

            /**
             * Возвращает класс границы для роли.
             * @param {string} role - Название роли.
             * @returns {string} - Класс Tailwind CSS.
             */
            function getRoleColor(role) {
                if (role.includes('Редактор')) return 'border-red-600';
                if (role.includes('Археолог')) return 'border-indigo-600';
                if (role.includes('Иллюстратор')) return 'border-purple-600';
                if (role.includes('Продюсер')) return 'border-teal-600';
                return 'border-gray-500';
            }


            /**
             * Обработчик события для копирования текста.
             */
            function copyResults() {
                const textToCopy = outputContainer.getAttribute('data-text-output');
                if (!textToCopy) return;

                // Используем document.execCommand('copy') для совместимости в iframe
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = textToCopy;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();

                let success = false;
                try {
                    success = document.execCommand('copy');
                } catch (err) {
                    console.error('Failed to copy text', err);
                }

                document.body.removeChild(tempTextArea);

                if (success) {
                    copyButton.textContent = 'Скопировано!';
                    copyButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                    copyButton.classList.add('bg-gray-500');
                    setTimeout(() => {
                        copyButton.textContent = 'Копировать результаты';
                        copyButton.classList.remove('bg-gray-500');
                        copyButton.classList.add('bg-green-600', 'hover:bg-green-700');
                    }, 2000);
                } else {
                    errorMessage.textContent = 'Ошибка копирования. Попробуйте скопировать текст вручную.';
                    errorMessage.classList.remove('hidden');
                }
            }


            // --- Инициализация и слушатели событий ---

            generateButton.addEventListener('click', generateGroups);
            copyButton.addEventListener('click', copyResults);

            // Убрана демонстрационная загрузка списка, чтобы поле было пустым.
        });
    </script>
</body>
</html>
